[project]
name = "strata"
version = "0.0.1"
description = "Series/Parallel Runner on top of mojo asyncrt"
authors = ["Samuel Ibarra <ing.samuelibarra@gmail.com>"]
platforms = ["linux-64", "osx-arm64"]

channels = [
    "https://conda.modular.com/max-nightly",
    "https://conda.modular.com/max",
    "https://repo.prefix.dev/modular-community",
    "https://repo.prefix.dev/conda-forge",
    "https://prefix.dev/pixi-build-backends",
]
preview = ["pixi-build"]

[tasks]
# Build
package = { depends-on = [
    "remove_package_folder",
    "create_package_folder",
    "build_package",
] }
remove_package_folder = "rm -rf package/"
create_package_folder = "mkdir package/"
build_package = "mojo package strata/ -o package/strata.mojopkg"

# Python Build
python_package = "mojo build strata/python_interop.mojo --emit shared-lib -o python/src/strata/mojo_strata.so"

# Testing
tests = { depends-on = [
    "test_docs"
] }
test_docs = "mojo test --diagnose-missing-doc-strings --validate-doc-strings"

[dependencies]
max = "*"

[package.build]
backend = { name = "pixi-build-rattler-build", version = "0.1.*" }
